import { Composer } from "grammy"
import { pluralize } from "numeralize-ru"
import { COFFEE_STICKERS, SHOCK_PATALOCK, TEA_STICKERS, TOKU_CHAT, WORLD_TRIGGER, PON_STICKER, ALCO_STICKERS } from "../constants"
import { DrinkCounters } from "../data"

export const fun = new Composer

const drinksCounters = DrinkCounters.fromFileSyncSafe('data/drinks.json')

// –®–û–ö –ü–ê–¢–ê–õ–û–ö
fun.hears(/–ø(–∞|a)—Ç(–∞|a)–ª(–æ|o)–∫|501\s?271|–æ–±–ª–∞—Å—Ç—å/gim, ctx => ctx.replyWithAudio(SHOCK_PATALOCK, { reply_to_message_id: ctx.msg.message_id }))

fun.hears(/—Ç—Ä–∏–≥–≥–µ—Ä/gim, ctx => ctx.replyWithSticker(WORLD_TRIGGER, { reply_to_message_id: ctx.msg.message_id }))

// –ü–æ–Ω
fun.hears(/(\P{L}|^)–ø–æ–Ω(\P{L}|$)/gimu, ctx => ctx.replyWithSticker(PON_STICKER, { reply_to_message_id: ctx.msg.message_id }))

fun.on(':sticker').filter(ctx => ctx.msg.chat.id == TOKU_CHAT, async ctx => {
    const sticker = ctx.msg.sticker.file_unique_id
    let drink: string
    let count: number
    let emoji: string
    let achivement = ''

    if (!TEA_STICKERS.concat(COFFEE_STICKERS).concat(ALCO_STICKERS).includes(sticker)) {
        return
    }

    if (TEA_STICKERS.includes(sticker)) {
        drinksCounters.tea += 1
        drink = '—á—è'
        count = drinksCounters.tea
        emoji = 'üçµ'
        switch (count) {
            case 1:
                achivement = '–ß–∞–π –±—É—à?'
                break
            case 28:
                achivement = '–í—ã –≤—ã–ø–∏–ª–∏ –≤–µ–¥—Ä–æ —á—è :0'
                break
            case 75:
                achivement = '–•–≤–∞—Ç–∏—Ç –Ω–∞ –∞–∫–≤–∞—Ä–∏—É–º. –° —á–∞–µ–º.'
                break
            case 80:
                achivement = '"–ó–∞–º–µ—á–∞—Ç–µ–ª—å–Ω—ã–π –¥–µ–Ω—å —Å–µ–≥–æ–¥–Ω—è. –¢–æ –ª–∏ —á–∞–π –ø–æ–π—Ç–∏ –≤—ã–ø–∏—Ç—å, —Ç–æ –ª–∏ –ø–æ–≤–µ—Å–∏—Ç—å—Å—è." (–ø—Ä–∏–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ê.–ü.–ß–µ—Ö–æ–≤—É)'
                break
            case 90:
                achivement = '"–ß–∞–π! –í–æ—Ç —á—Ç–æ –º–Ω–µ –±—ã–ª–æ –Ω—É–∂–Ω–æ! –•–æ—Ä–æ—à–∞—è —á–∞—à–∫–∞ —á–∞—è! –ü–µ—Ä–µ–≥—Ä–µ—Ç—ã–π –Ω–∞—Å—Ç–æ–π —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Ä–∞–¥–∏–∫–∞–ª–æ–≤ –∏ —Ç–∞–Ω–∏–Ω–∞, –æ–Ω –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è." (c) 10 –î–æ–∫—Ç–æ—Ä'
            case 100:
                achivement = '–¢–≤–æ–π —á–π –ø—Ä–æ–Ω–∑–∏—Ç –Ω–µ–±–µ—Å–∞!'
                break
            case 110:
                achivement = '‚Äî –•–æ—á–µ—à—å —á–∞—é?\n‚Äî –•–º... –ß–∞–π... –ú—ã —Ç–æ–ª—å–∫–æ –∏ –¥–µ–ª–∞–µ–º —Ç—É—Ç, —á—Ç–æ –ø—å–µ–º —á–∞–π. –ü–æ—Ä–∞–∂–∞—é—Å—å, –∫–∞–∫ –º—ã –≤ –Ω–µ–º –µ—â–µ –Ω–µ –∑–∞—Ö–ª–µ–±–Ω—É–ª–∏—Å—å.\n(–û—Ç–≥–æ–ª–æ—Å–∫–∏ –ø—Ä–æ—à–ª–æ–≥–æ)'
                break
            case 120:
                achivement = '–ß–∞—é? –≠—Ç–æ –∫–∞–∫ –æ–±—ä—è—Ç–∏—è. –¢–æ–ª—å–∫–æ –≤ —á–∞—à–∫–µ. (–ú–µ–Ω—Ç–∞–ª–∏—Å—Ç)'
                break
            case 130:
                achivement = '–¢–∞–∫–∏–µ –Ω—ã–Ω—á–µ –≤—Ä–µ–º–µ–Ω–∞, ‚Äî –∏–∑—Ä—ë–∫ –º–∏—Å—Ç–µ—Ä –ù–æ—Ä—Ä–∏—Å, –ø—Ä–∏–Ω—è–≤ —á–∞—à–∫—É —á–∞—è, ‚Äî —Ç–µ–±–µ –º–µ—à–∞—é—Ç –∂–∏—Ç—å, –∞ —Ç—ã –º–µ—à–∞–µ—à—å –ª–æ–∂–µ—á–∫–æ–π —á–∞–π.'
                break
            case 140:
                achivement = '–ù–µ –ø–µ–π —á–∞–π —Ç–∞–º, –≥–¥–µ —Ç–µ–±—è –Ω–µ–Ω–∞–≤–∏–¥—è—Ç.'
                break
            case 150:
                achivement = '"–Ø –¥–æ–ª–∂–µ–Ω –±—ã–ª –ø–∏—Ç—å –º–Ω–æ–≥–æ —á–∞—è, –∏–±–æ –±–µ–∑ –Ω–µ–≥–æ –Ω–µ –º–æ–≥ —Ä–∞–±–æ—Ç–∞—Ç—å. –ß–∞–π –≤—ã—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥—Ä–µ–º–ª—é—Ç –≤ –≥–ª—É–±–∏–Ω–µ –º–æ–µ–π –¥—É—à–∏." –õ–µ–≤ –¢–æ–ª—Å—Ç–æ–π'
                break
            case 200:
                achivement = '–ü–æ—Ä–∞ –∑–∞–≤–æ–¥–∏—Ç—å —á–∞–µ–≥–æ–Ω–Ω—ã–π –∞–ø–ø–∞—Ä—Ç –Ω–∞ 60 –ª–∏—Ç—Ä–æ–≤.'
            case 250:
                achivement = '–¢–µ–ø–µ—Ä—å –≤—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ—Å—Ç–æ–∏—Ç–µ –∏–∑ —á–∞—è.'
                break
            case 300:
                achivement = '–•–≤–∞—Ç–∏—Ç —á—Ç–æ–±—ã –Ω–∞–ø–æ–ª–Ω–∏—Ç—å —Å—Ç–∏—Ä–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É. –ß–∞–µ–º, –∫–æ–Ω–µ—á–Ω–æ –∂–µ.'
            case 1337:
                achivement = '31337 t34'
                break
        }
    } else if (COFFEE_STICKERS.includes(sticker)) {
        drinksCounters.coffee += 1
        drink = '–∫—Ñ–µ'
        count = drinksCounters.coffee
        emoji = '‚òïÔ∏è'
        switch (count) {
            case 1:
                achivement = '–ù–∞ —ç—Ç–æ–º —Ç—ã –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è. –¢–∞–∫ –º–Ω–µ —Å–∫–∞–∑–∞–ª –º–æ–π –ø–æ–±–æ—á–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç.'
                break
            case 50:
                achivement = 'What is this, a coffee episode?'
                break
            case 60:
                achivement = '–ù–∏—á—Ç–æ –Ω–∞ —Å–≤–µ—Ç–µ –Ω–µ –¥–∞—ë—Ç—Å—è –¥–∞—Ä–æ–º. –î–∞–∂–µ –∫–æ—Ñ–µ.'
                break
            case 70:
                achivement = 'Go beyond! Plus coffee'
                break
            case 80:
                achivement = 'I can\'t go on like this. I\'ll drink coffee!'
                break
            case 90:
                achivement = 'More importantly, where\'s coffee!?'
                break
            case 100:
                achivement = '–¢—ã –≤—ã–ø–∏–ª 100 —á–∞—à–µ–∫ –∫–æ—Ñ–µ? –ö–∞–∫ –º–∏–ª–æ'
                break
            case 150:
                achivement = '–í–æ-–ø–µ—Ä–≤—ã—Ö, —É —Ç–µ–±—è –ª–∏—à—å —Å—Ç–æ –ø—è—Ç—å–¥–µ—Å—è—Ç —á–∞—à–µ–∫ –∫–æ—Ñ–µ. –í–æ-–≤—Ç–æ—Ä—ã—Ö, –¥–µ–ª–∞–π, –∫–∞–∫ —è –≥–æ–≤–æ—Ä—é, –∏ –Ω–µ –≤–∑–¥—É–º–∞–π –ø–∏—Ç—å –º–µ–Ω—å—à–µ –∫–æ—Ñ–µ. –í-—Ç—Ä–µ—Ç—å–∏—Ö, —á—Ç–æ –±—ã –Ω–∏ –±—ã–ª–æ –≤ –ø—Ä–æ—à–ª–æ–º, —á–∞—à–∫–∏ —á–∞—è —Ç–µ–±—è –Ω–µ –∫–∞—Å–∞—é—Ç—Å—è'
                break
            case 200:
                achivement = '–°–ª–æ–º–∞–π —Å–∏—Å—Ç–µ–º—É, –ø–æ—Å–º–æ—Ç—Ä–∏ –∞–Ω–∏–º–µ, –≥–¥–µ –º–∏–ª—ã–µ –¥–µ–≤–æ—á–∫–∏ –ø—å—é—Ç –∫—Ñ–µ.'
                break
            case 250:
                achivement = 'Wonder Coffee Priority'
                break
            case 300:
                achivement = 'Half human, half coffee, completely awesome.'
                break
            case 1300:
                achivement = '–≠—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —á—Ç–æ–±—ã –Ω–∞–ø–æ–ª–Ω–∏—Ç—å –≤–∞–Ω–Ω—É!'
                break
        }
    } else {
        drinksCounters.alco += 1
        drink = '–∞–ª–∫'
        count = drinksCounters.alco
        emoji = 'üç∫'
        switch (count) {
            case 1:
                achivement = '–ù–∞ —ç—Ç–æ–º —Ç—ã –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è. –¢–∞–∫ –º–Ω–µ —Å–∫–∞–∑–∞–ª –º–æ–π –ø–æ–±–æ—á–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç.'
                break
            case 5:
                achivement = '–í —Ä–∞—é –Ω–µ—Ç –ø–∏–≤–∞, –ø–æ—ç—Ç–æ–º—É –º—ã –ø—å—ë–º –µ–≥–æ –Ω–∞ —ç—Ç–æ–π –≥—Ä–µ—à–Ω–æ–π –∑–µ–º–ª–µ.'
                break
            case 10:
                achivement = '–•–æ—Ä–æ—à–∏–µ –ª—é–¥–∏ –ø—å—é—Ç —Ö–æ—Ä–æ—à–µ–µ –ø–∏–≤–æ.'
                break
            case 20:
                achivement = '–Ø –Ω–µ –≤–µ—Ä—é –Ω–∏ –≤–æ —á—Ç–æ, –∫—Ä–æ–º–µ –ª—é–±–≤–∏. –ò –ø–∏–≤–∞.'
                break
            case 30:
                achivement = '–Ø –≤–æ–æ–±—â–µ –Ω–µ –ø—å—é –º–æ–ª–æ–∫–æ. –ú–æ–ª–æ–∫–æ —ç—Ç–æ –¥–ª—è –º–ª–∞–¥–µ–Ω—Ü–µ–≤, –∞ –∫–æ–≥–¥–∞ –≤—ã—Ä–∞—Å—Ç–∞–µ—à—å –Ω—É–∂–Ω–æ –ø–∏—Ç—å –ø–∏–≤–æ.'
                break
            case 40:
                achivement = '–î—É—Ä–∞–∫–∏ —É—á–∞—Ç—Å—è –Ω–∞ —Å–≤–æ–∏—Ö –æ—à–∏–±–∫–∞—Ö, —É–º–Ω—ã–µ –Ω–∞ —á—É–∂–∏—Ö, –∞ –º—É–¥—Ä—ã–µ —Å–º–æ—Ç—Ä—è—Ç –Ω–∞ –Ω–∏—Ö –∏ –Ω–µ —Å–ø–µ—à–∞ –ø—å—é—Ç –ø–∏–≤–æ.'
                break
            case 50:
                achivement = '–õ—é–±–ª—é –ø–∏—Å–∞—Ç—å –ø–µ—Å–Ω–∏. –õ—é–±–ª—é, –∫–æ–≥–¥–∞ –º–µ–Ω—è –æ–∫—Ä—É–∂–∞—é—Ç –Ω–∞—Å—Ç–æ—è—â–∏–µ –¥—Ä—É–∑—å—è. –õ—é–±–ª—é –ø—É—Ç–µ—à–µ—Å—Ç–≤–æ–≤–∞—Ç—å. –ò –ª—é–±–ª—é –∏–≥—Ä–∞—Ç—å –Ω–∞ –≥–∏—Ç–∞—Ä–µ. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, –ª—é–±–ª—é –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –ø–∏–≤–æ.'
                break
            case 60:
                achivement = '–í—ã –±–æ–∏—Ç–µ—Å—å —É–º–∏—Ä–∞—Ç—å?\n‚Äî –ö—Ç–æ ‚Äî —è? –ù—É —É–∂ –Ω–µ—Ç! –Ø —Ç–∞–∫ –±–ª–∏–∑–∫–æ –∫ —Å–º–µ—Ä—Ç–∏ –ø–æ–¥—Ö–æ–¥–∏–ª –ø–∞—Ä—É —Ä–∞–∑, —á—Ç–æ –Ω–µ –±–æ—é—Å—å. –ö–æ–≥–¥–∞ –∫ –Ω–µ–π —Ç–∞–∫ –±–ª–∏–∑–∫–æ, —Ç–µ–±–µ, –ø–æ–∂–∞–ª—É–π, –¥–∞–∂–µ —Ö–æ—Ä–æ—à–æ. –¢—ã –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫–æ–π: ¬´–ù—É –ª–∞–¥–Ω–æ, –ª–∞–¥–Ω–æ¬ª. –û—Å–æ–±–µ–Ω–Ω–æ, –ø–æ-–º–æ–µ–º—É, –µ—Å–ª–∏ –≤ –ë–æ–≥–∞ –Ω–µ –≤–µ—Ä–∏—à—å, —Ç–µ–±—è –Ω–µ –≤–æ–ª–Ω—É–µ—Ç, –∫—É–¥–∞ –ø–æ–ø–∞–¥—ë—à—å ‚Äî –≤ —Ä–∞–π –∏–ª–∏ –∞–¥, –∏ —Ç—ã –ø—Ä–æ—Å—Ç–æ –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—à—å –≤—Å—ë, —á–µ–º –∑–∞–Ω–∏–º–∞–ª—Å—è. –ì—Ä—è–¥—ë—Ç –∫–∞–∫–∞—è-—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–∞, –Ω–æ–≤–æ–µ –∫–∏–Ω–æ –ø–æ–∫–∞–∂—É—Ç, –ø–æ—ç—Ç–æ–º—É, —á—Ç–æ –±—ã —Ç–∞–º –Ω–∏ –±—ã–ª–æ, —Ç—ã –≥–æ–≤–æ—Ä–∏—à—å: ¬´–õ–∞–¥–Ω–æ¬ª. –ö–æ–≥–¥–∞ –º–Ω–µ –±—ã–ª–æ —Ç—Ä–∏–¥—Ü–∞—Ç—å –ø—è—Ç—å, –º–µ–Ω—è –≤ –±–æ–ª—å–Ω–∏—Ü–µ –æ–±—ä—è–≤–∏–ª–∏ –ø–æ–∫–æ–π–Ω–∏–∫–æ–º. –ê —è –Ω–µ —É–º–µ—Ä. –Ø –≤—ã—à–µ–ª –∏–∑ –±–æ–ª—å–Ω–∏—Ü—ã ‚Äî –ø—Ä–∏—á—ë–º –º–Ω–µ –≤–µ–ª–µ–ª–∏ –Ω–∏–∫–æ–≥–¥–∞ –±–æ–ª—å—à–µ –Ω–µ –ø–∏—Ç—å, –∏–ª–∏ —è —Ç–æ—á–Ω–æ —É–º—Ä—É, ‚Äî –∏ –ø—Ä—è–º—ã–º —Ö–æ–¥–æ–º –æ—Ç–ø—Ä–∞–≤–∏–ª—Å—è –≤ –±–∞—Ä, –≥–¥–µ –∏ –≤—ã–ø–∏–ª –ø–∏–≤–∞. –ù–µ—Ç, –¥–≤–∞ –ø–∏–≤–∞!'
                break
            case 70:
                achivement = '17 –∏—é–Ω—è. <‚Ä¶> –í–¥–æ–ª—å –†–µ–π–Ω–∞. –í—Å–ø–æ–º–∏–Ω–∞–ª –ª–µ—Ç–Ω—é—é –ø–æ–µ–∑–¥–∫—É. –î–≤–µ –µ–¥—ã, —á–∞—Å—Ç—ã–µ –≤—ã–ø–∏–≤–∫–∏ –∫–æ—Ñ–µ –∏ –ø–∏–≤–∞, —á—Ç–æ–±—ã —É–±–∏—Ç—å –≤—Ä–µ–º—è –∏ —Ç–æ—Å–∫—É, –∫–æ—Ç–æ—Ä–∞—è —Ç–µ–º –±–æ–ª–µ–µ –¥—É—à–∏–ª–∞, —á—Ç–æ –∫–Ω–∏–≥–∞ –ø–æ–ø–∞–ª–∞—Å—å –ø–æ–¥–ª–∞—è La terre Zola. –Ø —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ –Ω–µ–Ω–∞–≤–∏–∂—É —ç—Ç–æ–≥–æ —Å–∫–æ—Ç–∞, –Ω–µ —Å–º–æ—Ç—Ä—è –Ω–∞ –≤–µ—Å—å –µ–≥–æ —Ç–∞–ª–∞–Ω—Ç.'
                break
            case 80:
                achivement = '–Ø –Ω–µ —Ç–æ—Ä–≥—É—é –Ω–∏ –≥–∞–∑–æ–º, –Ω–∏ –æ–≥—É—Ä—Ü–∞–º–∏, –Ω–∏ –ø–∏–≤–æ–º, –Ω–∏ —Å–∞–ª–æ–º ‚Äî –Ω–∏—á–µ–º. –í–æ—Ç —ç—Ç–æ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å. –û–Ω–∏ —Ç–∞–º –º–µ–∂–¥—É —Å–æ–±–æ–π –¥–æ–ª–∂–Ω—ã –¥–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è. –ù–æ —Ü–µ–Ω–∞, –∫–æ–Ω–µ—á–Ω–æ, –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä—ã–Ω–æ—á–Ω–æ–π. –≠—Ç–æ –æ—á–µ–≤–∏–¥–Ω–æ.'
                break
            case 90:
                achivement = '–í –±–æ–ª—å–Ω–∏—Ü–µ –ò–Ω—Å—Ç–∏—Ç—É—Ç–∞ –ë–ª–æ—Ö–∏–Ω–∞ –°–≤–µ—Ç–ª–æ–≤ —É–º–∏—Ä–∞–ª –æ—Ç —Ä–∞–∫–∞. –ù–µ —Å—Ç–∞–ª –ø–∏—Ç—å –ø—Ä–∏–Ω–µ—Å—ë–Ω–Ω—ã–π –∫–æ–Ω—å—è–∫ –∏ —Å–∫–∞–∑–∞–ª –≥—Ä—É—Å—Ç–Ω–æ: ¬´–ö —Ä–∞–∫—É –ø–∏–≤–æ –Ω–∞–¥–æ‚Ä¶¬ª'
                break
            case 100:
                achivement = '–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ! –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–µ–¥—É–≥–∞–¥–∞—Ç—å —ç—Ç–æ—Ç –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª! –û–Ω–∞ —Å–∏–¥–∏—Ç —É—Ç—Ä–æ–º, –±–ª–µ–¥–Ω–∞—è, –æ–±—Ö–≤–∞—Ç–∏–≤ –≥–æ–ª–æ–≤—É —Ä—É–∫–∞–º–∏, –≤–∑–¥—ã—Ö–∞–µ—Ç:\n‚Äî –û–π, –∫–∞–∫ –º–Ω–µ –ø–ª–æ—Ö–æ‚Ä¶ –í—á–µ—Ä–∞ –ø–∏–ª–∏ –≤–æ–¥–∫—É, –ø–æ—Ç–æ–º –ø–∏–≤–æ, –ø–æ—Ç–æ–º –∫–æ–Ω—å—è–∫‚Ä¶ –ù–∞–≤–µ—Ä–Ω–æ–µ, –≤–∏–Ω–µ–≥—Ä–µ—Ç–æ–º –æ—Ç—Ä–∞–≤–∏–ª–∞—Å—å.'
                break
        }
    }

    await drinksCounters.toFile('data/drinks.json')
    await ctx.reply(`–ü—Ä–∏—è—Ç–Ω–æ–≥–æ! –ü–æ–ø–∏–ª–∏ ${drink} ${count} ${pluralize(count, '—Ä–∞–∑', '—Ä–∞–∑–∞', '—Ä–∞–∑')}  ${emoji}\n${achivement}`, {
        reply_to_message_id: ctx.msg.message_id
    })
})
